!function(a){function b(b,c){var d=a.extend(!0,{type:c},m.notifyOption);a.growl({message:b},d)}function c(b,c,d,e,f,g){f=f!==!1,a.ajax({type:b,url:c,cache:!1,data:d,success:function(a){a[m.json.flag]?e?t.findEvent(e)(a[m.json.data]):"post"===b&&(v.success(n.msg.success),y.reload(),A.hide()):(v.error(a.msg),g&&g())},dataType:"json",global:f})}function d(b){m.$leftSidebar.find("a.active").removeClass("active"),m.$leftSidebar.find("div.toggled,li.toggled").removeClass("active toggled"),m.$leftSidebar.find("div.profile-menu>ul.main-menu").hide(),m.$leftSidebar.find("li.sub-menu>ul").hide(),b=i(b);var c=b.target;c?m.$leftSidebar.find('a[data-target="'+c+'"]').each(function(){var b=a(this),c=b.parents("li.sub-menu");if(c.length)c.addClass("active toggled"),c.find(">ul").show(),b.addClass("active");else{b.parent().addClass("active");var d=b.parents("div.profile-menu");d.length&&(d.addClass("toggled"),d.find("ul.main-menu").show())}}):m.$leftSidebar.find("div.sidebar-inner>ul.main-menu>li:first").addClass("active")}function e(a,b,c,d){b&&"#"!==b||(b=m.defaultHash),b=i(b),w.getJSON(b.url,b.data,function(c){c[m.json.query]=b.data,c[m.json.lang]=n;var e=c[m.json.breadcrumbs];"string"==typeof e&&(c[m.json.breadcrumbs]=[{title:e}]);var i=c[m.json.pagination];i&&(c.pagination=f(i));var k=c[m.json.tempData];k&&(window[m.json.tempData]=k,delete c[m.json.tempData]),j(a,b.tpl,c),g(a),h(a),d&&d()},c)}function f(a){function b(a,b){var c=m.json.pageInfo.pageIndex,d=m.json.pageInfo.pageCount;return"#"+URI(window.location.hash.substring(1)).setSearch(c,a).setSearch(d,b)}var c=a[m.json.pageInfo.totalCount];if(!c)return"";var d=m.json.pageInfo.showCount||3,e=a[m.json.pageInfo.pageCount]||8,f=a[m.json.pageInfo.pageIndex]||0,g=Math.ceil(c/e),h=f+1;1>h&&(h=1),h>g&&(h=g);var i=h-d;1>i&&(i=1);var j=h+d;j>g&&(j=g);var k='<li><a><i class="zmdi zmdi-more-horiz"></i></a></li>',l='<div class="bootgrid-footer container-fluid"><div class="row"><div class="col-sm-12 m-b-25"><ul class="pagination">';l+="<li",1===h&&(l+=' class="disabled"'),l+="><a",1!==h&&(l+=' href="'+b(h-2,e)+'"'),l+=' aria-label="'+n.btn.prev+'"><i class="zmdi zmdi-chevron-left"></i></a></li>',i>1&&(l+=k);for(var o=i;j>=o;o++)l+="<li",o===h&&(l+=' class="active"'),l+='><a href="'+b(o-1,e)+'">'+o,o===h&&(l+=' <span class="sr-only">(current)</span>'),l+="</a></li>";return g>j&&(l+=k),l+="<li",h===g&&(l+=' class="disabled"'),l+="><a",h!==g&&(l+=' href="'+b(h,e)+'"'),l+=' aria-label="'+n.btn.next+'"><i class="zmdi zmdi-chevron-right"></i></a></li>',l+="</ul></div></div></div>"}function g(b){var c=t.findSelector(b);if(Waves.attach(".btn:not(.btn-icon):not(.btn-float)"),Waves.attach(".btn-icon, .btn-float",["waves-circle","waves-float"]),Waves.init(),c.find(".lightbox").lightGallery({enableTouch:!0}),c.find(".html-editor").summernote({height:200,lang:m.lang}),c.find(".fg-float .form-control").each(function(){var b=a(this).val();0==!b.length&&a(this).closest(".fg-line").addClass("fg-toggled")}),!q.hasClass("ismobile")){var d=c.find(".table-responsive");d[0]&&t.scrollbar(d,"rgba(0,0,0,0.5)","5px"),d=c.find(".chosen-results"),d[0]&&t.scrollbar(d,"rgba(0,0,0,0.5)","5px"),d=c.find(".tab-nav"),d[0]&&t.scrollbar(d,"rgba(0,0,0,0)","1px"),d=c.find(".c-overflow"),d[0]&&t.scrollbar(d,"rgba(0,0,0,0.5)","5px")}}function h(b){var c=t.findSelector(b);c.find(".form-validate").validationEngine({scroll:!0}),c.find(".tbl-tree").each(function(){var b=a(this),c=parseInt(b.data("lvl"));z.tree(b,c)}),c.find(".tbl-dyna-tree").each(function(){var b=a(this),c=b.data("url"),d=b.data("tpl");z.dynaTree(b,c,d)}),c.find(".select-picker").each(function(){var b=a(this),c=b.data("value");b.selectpicker(),c&&b.selectpicker("val",c)}),c.find(".date-picker").datetimepicker({format:m.dateFormat}),c.find(".date-time-picker").datetimepicker(),c.find(".daterange-picker").daterangepicker({autoApply:!0,locale:{format:m.dateFormat}}),c.find(".auto-complete,.auto-select").each(function(){var b=a(this),c=b.data("url");if(c){var d={ajax:{url:c,triggerLength:1,scrollBar:!0}};if(b.hasClass("auto-select")){var e=b.attr("name");b.removeAttr("name");var f=b.data("text")||"";b.after(a('<input type="hidden" class="selected-text" value="'+f+'" name="'+e+'Text">')),b.after(a('<input type="hidden" class="selected-value" value="'+b.val()+'" name="'+e+'">')),b.val(f),d.onSelect=function(a){b.nextAll(".selected-text").val(a.text),b.nextAll(".selected-value").val(a.value);var c=b.data("fn");c&&window[c](a)},b.blur(function(){var a=b.val(),c=b.nextAll(".selected-text").val();a?a!==c&&b.val(c):(b.nextAll(".selected-text").val(""),b.nextAll(".selected-value").val(""))})}b.typeahead(d)}}),c.find(".upload-xsl input").each(function(){a(this).fileupload({url:a(this).data("url"),dataType:"json",acceptFileTypes:/(\.|\/)(xls|xlsx)$/i,maxFileSize:2097152,messages:{acceptFileTypes:"只能上传EXCEL文件",maxFileSize:"文件大小不能超过2M"}}).on("fileuploadprocessalways",function(a,b){var c=b.files[b.index];if(c.error){var d=c.name+" : "+c.error;v.error(d)}}).on("fileuploaddone",function(a,b){b.result.flag?(v.success("上传成功"),y.reload()):v.error(b.result.msg)}).on("fileuploadfail",function(a,b){v.error("文件无法上传到服务器")}).prop("disabled",!a.support.fileInput).parent().addClass(a.support.fileInput?void 0:"disabled")})}function i(a){"#"===a.substr(0,1)&&(a=a.substring(1));var b=URI(a),c=b.path(),d=b.query(!0),e=d[m.hash.tpl]||c,f=d[m.hash.target]||e;return delete d[m.hash.tpl],delete d[m.hash.target],{url:c,tpl:e,data:d,target:f}}function j(a,b,c){var d=t.findSelector(a),e=template(b,c);d.html(e)}function k(b,d,e,f){var g=t.findSelector(b),h=d||1,i={expandLevel:h};e&&f&&(i.beforeExpand=function(b,d){z.hasChild(b,d)||c("get",e.replace("#id#",d),null,function(c){if(c.list){c.pid=d;var e=template(f,c);b.addChilds(e)}else a("#"+d+' span[arrow="true"]').attr("class","vsStyle_node vsStyle_last_leaf")},!0,function(){a("#"+d+' span[arrow="true"]').attr("class","vsStyle_active_node vsStyle_last_shut")})}),g.treeTable(i)}function l(){y.load(window.location.hash),function(){o.on("hashchange",function(){y.load(window.location.hash)}),p.ajaxSend(function(){NProgress.start()}).ajaxComplete(function(){NProgress.done()}).ajaxError(function(a,b,c){var d={};switch(d.status=b.status,d.url=c.url,d.status){case 401:u.confirm(n.msg.e401,function(){window.location.href=m.logoutUrl});break;case 403:v.error(n.msg.e403);break;case 404:d.msg=n.msg.e404,y.loadStatic(m.$content,"public/error",d);break;case 408:v.error(n.msg.e408);break;case 500:d.msg=n.msg.e500,y.loadStatic(m.$content,"public/error",d);break;default:console.log(d)}})}(),function(){r.on("click","#top-search > a",function(b){b.preventDefault(),a("#header").addClass("search-toggled"),a("#top-search-wrap").find("input").focus()}),r.on("click","#top-search-close",function(b){b.preventDefault(),a("#header").removeClass("search-toggled")});var b=localStorage.getItem("ma-layout-status");1==b&&(r.addClass("sw-toggled"),a("#tw-switch").prop("checked",!0)),r.on("change","#toggle-width input:checkbox",function(){a(this).is(":checked")?setTimeout(function(){r.addClass("toggled sw-toggled"),localStorage.setItem("ma-layout-status",1)},250):setTimeout(function(){r.removeClass("toggled sw-toggled"),localStorage.setItem("ma-layout-status",0),a(".main-menu > li").removeClass("animated")},250)}),r.on("click",'a[data-action="fullscreen"]',function(b){function c(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}b.preventDefault(),c(document.documentElement),a(this).closest(".dropdown").removeClass("open")}),r.on("click",'a[data-action="clear-localstorage"]',function(a){a.preventDefault(),mycatui.msg.confirm(n.msg.clearLocalstorageConfirm,function(){localStorage.clear(),mycatui.notify.success(n.msg.clearLocalstorageSuccess)})}),r.on("click","#menu-trigger, #chat-trigger",function(b){b.preventDefault();var c=a(this).data("trigger");a(c).toggleClass("toggled"),a(this).toggleClass("open"),r.toggleClass("modal-open"),a(".sub-menu.toggled").not(".active").each(function(){a(this).removeClass("toggled"),a(this).find("ul").hide()}),a(".profile-menu .main-menu").hide();var d,e;"#sidebar"==c?(d="#sidebar",e="#menu-trigger",a("#chat-trigger").removeClass("open"),m.$rightSidebar.hasClass("toggled")?m.$rightSidebar.removeClass("toggled"):m.$header.toggleClass("sidebar-toggled")):"#chat"==c&&(d="#chat",e="#chat-trigger",a("#menu-trigger").removeClass("open"),m.$leftSidebar.hasClass("toggled")?m.$leftSidebar.removeClass("toggled"):m.$header.toggleClass("sidebar-toggled")),m.$header.hasClass("sidebar-toggled")&&p.on("click",function(b){0===a(b.target).closest(d).length&&0===a(b.target).closest(e).length&&setTimeout(function(){r.removeClass("modal-open"),a(d).removeClass("toggled"),m.$header.removeClass("sidebar-toggled"),a(e).removeClass("open")})})})}(),function(){r.on("click","div.profile-menu>a,li.sub-menu>a",function(b){b.preventDefault();var c=a(this);c.next().slideToggle(200),c.parent().toggleClass("toggled")}),r.on("click",'a[data-action="logout"]',function(a){a.preventDefault(),mycatui.msg.confirm(n.msg.logoutConfirm,function(){window.location.href=m.logoutUrl})})}(),function(){r.on("click",".btn-nav",function(){var b=a(this).attr("href");b===window.location.hash&&y.load(b)}),r.on("click",".btn-search",function(b){b.preventDefault();var c=a(this).parents("form"),d=c.attr("action");d+=-1===d.indexOf("?")?"?":"&",d+=c.serialize(),window.location.hash=d}),r.on("click",".btn-del",function(b){b.preventDefault();var c=a(this),d=c.data("id"),e=c.parents("tbody");return e.hasClass("tree_table")&&z.hasChild(e,d)?void v.error(n.msg.notDeleteTreeHasChild):void u.confirm(n.msg.deleteConfirm,function(){var a=c.data("url"),b={id:d};w.postJSON(a,b)})}),r.on("click",".btn-save",function(b){b.preventDefault();var c=a(this),d=c.data("fnPre");if(!d||window[d]()!==!1){var e=c.parents("form");e.validationEngine("validate")&&w.postJSON(e.prop("action"),e.serialize(),c.data("fn"))}}),r.on("click",".btn-modal",function(b){b.preventDefault();var c=a(this),d=t.findAttr(c,"href"),e=c.data("size");A.show(d,e)}),r.on("click","table input.chk-all",function(){a(this).parents("table").find("tbody input.chk-line").prop("checked",this.checked)}),r.on("click","table input.chk-line",function(){function b(d){var e=a("#"+d).attr("pid");e&&(a("#"+e).find(".chk-line").prop("checked",!0),f.hasClass("tree-single")&&c(e),b(e))}function c(b){var c=a("#"+b),e=c.attr("pid");c.siblings('[pid="'+e+'"]').find(".chk-line").each(function(){this.checked=!1,d(this.value,!1)})}function d(b,c){f.find("."+b).each(function(){a(this).find(".chk-line").prop("checked",c),d(this.id,c)})}var e=a(this),f=e.parents("tbody");if(f.hasClass("tree_table")){var g=this.value;this.checked&&f.hasClass("tree-single")?c(g):d(g,this.checked),this.checked&&b(g)}else{var h=!0;f.find(".chk-line").each(function(){return this.checked?void 0:(h=!1,!1)}),f.parent().find(".chk-all").prop("checked",h)}}),r.on("click",".btn-export",function(b){b.preventDefault();var c=a(this),d=c.data("url"),e=c.data("formId"),f={};e&&(f=a("#"+e).serialize()),w.getJSON(d,f,function(a){t.json2excel(a)})}),r.on("click",".upload-xsl",function(b){b.preventDefault(),a(this).find("input").click()}).on("click",".upload-xsl input",function(a){a.stopPropagation()}),r.on("click",".lvh-search-trigger",function(b){b.preventDefault(),x=a(this).closest(".lv-header-alt").find(".lvh-search"),x.fadeIn(300),x.find(".lvhs-input").focus()}),r.on("click",".lvh-search-close",function(){x.fadeOut(300),setTimeout(function(){x.find(".lvhs-input").val("")},350)}),r.on("focus",".form-control",function(){a(this).closest(".fg-line").addClass("fg-toggled")}),r.on("blur",".form-control",function(){var b=a(this).closest(".form-group"),c=b.find(".form-control").val();b.hasClass("fg-float")?0==c.length&&a(this).closest(".fg-line").removeClass("fg-toggled"):a(this).closest(".fg-line").removeClass("fg-toggled")})}()}var m,n,o=a(window),p=a(document),q=a("html"),r=a("body"),s={topHash:"",menuHash:"",defaultHash:"",logoutUrl:"",lang:"zh-cn",json:{flag:"flag",msg:"msg",data:"data",breadcrumbs:"breadcrumbs",pagination:"pageInfo",pageInfo:{totalCount:"totalCount",pageIndex:"pageIndex",pageCount:"pageCount",showCount:3},tempData:"tempData",query:"query",lang:"lang"},dateFormat:"YYYY-MM-DD",notifyOption:{placement:{from:"bottom",align:"right"},delay:3e3,animate:{enter:"animated fadeInRight",exit:"animated fadeOutRight"}},hash:{tpl:"tpl",target:"target"},NProgressParent:"#main",$header:a("#header"),$leftSidebar:a("#sidebar"),$rightSidebar:a("#chat"),$content:a("#content"),$modal:a("#divModal")},t={findAttr:function(a,b){var c=this.findSelector(a);return c.attr(b)||c.data(b)},findEvent:function(a){return"string"==typeof a?window[a]:a},findSelector:function(b){return"string"==typeof b?a("#"+b):b},scrollbar:function(a,b,c){a.niceScroll({cursorcolor:b,cursorborder:0,cursorborderradius:0,cursorwidth:c,bouncescroll:!0,mousescrollstep:100})},json2excel:function(b){var c,d,e=b.sheet||"Sheet1",f="<table>";if(b.title){for(f+="<tr>",c=0;c<b.title.length;c++)f+="<td>"+b.title[c]+"</td>";f+="</tr>"}if(b.list)for(c=0;c<b.list.length;c++){for(f+="<tr>",d=0;d<b.list[c].length;d++)f+="<td>"+b.list[c][d]+"</td>";f+="</tr>"}f+="</table>";var g="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:excel' xmlns='http://www.w3.org/TR/REC-html40'>";g+="<head>",g+="<!--[if gte mso 9]>",g+="<xml>",g+="<x:ExcelWorkbook>",g+="<x:ExcelWorksheets>",g+="<x:ExcelWorksheet>",g+="<x:Name>",g+=e,g+="</x:Name>",g+="<x:WorksheetOptions>",g+="<x:DisplayGridlines/>",g+="</x:WorksheetOptions>",g+="</x:ExcelWorksheet>",g+="</x:ExcelWorksheets>",g+="</x:ExcelWorkbook>",g+="</xml>",g+="<![endif]-->",g+="</head>",g+="<body>",g+=f,g+="</body>",g+="</html>";var h="base64,"+a.base64.encode(g);window.open("data:application/vnd.ms-excel;filename=exportData.doc;"+h)}},u={info:function(a,b){swal({title:a,text:b,type:"info",confirmButtonText:n.btn.close})},success:function(a,b){swal({title:a,text:b,type:"success",confirmButtonText:n.btn.close})},error:function(a,b){swal({title:a,text:b,type:"error",confirmButtonText:n.btn.close})},confirm:function(a,b){swal({title:a,type:"warning",showCancelButton:!0,cancelButtonText:n.btn.cancel,confirmButtonText:n.btn.ok},function(){b&&t.findEvent(b)()})}},v={info:function(a){b(a,"info")},success:function(a){b(a,"success")},warning:function(a){b(a,"warning")},error:function(a){b(a,"danger")}},w={getJSON:function(a,b,d,e){c("get",a,b,d,e)},postJSON:function(a,b,d,e){c("post",a,b,d,e)}},y={loadStatic:function(a,b,c){j(a,b,c)},load:function(a){e(m.$content,a),d(a)},reload:function(){this.load(window.location.hash)},loadPart:function(a,b){e(a,b,!1)}},z={tree:function(a,b){k(a,b)},dynaTree:function(a,b,c){k(a,!1,b,c)},hasChild:function(b,c){return!!a("."+c,t.findSelector(b)).length},getCheckedValue:function(a){return t.findSelector(a).find(".chk-line:checked").serialize()}},A={show:function(a,b){e(m.$modal.find(".modal-content"),a,!0,function(){var a=m.$modal.children();a.removeClass("modal-lg modal-sm"),("modal-lg"===b||"modal-sm"===b)&&a.addClass(b),m.$modal.modal("show")})},hide:function(){m.$modal.modal("hide")}},B={sparklineBar:function(a,b,c,d,e,f){t.findSelector(a).sparkline(b,{type:"bar",height:c,barWidth:d,barColor:e,barSpacing:f})},sparklineLine:function(a,b,c,d,e,f,g,h,i,j,k,l,m){t.findSelector(a).sparkline(b,{type:"line",width:c,height:d,lineColor:e,fillColor:f,lineWidth:g,maxSpotColor:h,minSpotColor:i,spotColor:j,spotRadius:k,highlightSpotColor:l,highlightLineColor:m})},sparklinePie:function(a,b,c,d,e){t.findSelector(a).sparkline(b,{type:"pie",width:c,height:d,sliceColors:e,offset:0,borderWidth:0})},easyPieChart:function(a,b,c,d,e,f,g){t.findSelector(a).easyPieChart({trackColor:b,scaleColor:c,barColor:d,lineWidth:e,lineCap:f,size:g})}},C={createByOp:function(a,b,c){a="echarts/chart/"+a,require(["echarts",a],function(a){var d=a.init(document.getElementById(b));d.setOption(c)})},createByOpName:function(a,b,c){var d=window[m.json.tempData][c];delete window[m.json.tempData][c],this.createByOp(a,b,d)}};window.mycatui={langs:[],init:function(b){m=a.extend(!0,{},s,b),n=this.langs[m.lang],moment.locale("zh_cn"),NProgress.configure({parent:m.NProgressParent}),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?q.addClass("ismobile"):t.scrollbar(q,"rgba(0,0,0,0.3)","5px"),y.loadPart(m.$header,m.topHash),e(m.$leftSidebar,m.menuHash,!1,function(){l()})},msg:u,notify:v,ajax:w,page:y,table:z,chart:B,echart:C}}(window.jQuery);
